# üìä –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—Ç—á–µ—Ç–æ–≤

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`)

### 2. –ü–æ–ª—É—á–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞/—á–∞—Ç–∞

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏—á–Ω—ã–π —á–∞—Ç**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@userinfobot](https://t.me/userinfobot)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID (–Ω–∞–ø—Ä–∏–º–µ—Ä: `123456789`)

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª**
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª
2. –î–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ –±–æ—Ç–∞ (–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π)
3. –ü–µ—Ä–µ—à–ª–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ –≤ [@userinfobot](https://t.me/userinfobot)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∫–∞–Ω–∞–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `-1001234567890`)

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª:

```bash
# –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤
ENABLE_REPORTS=true
REPORTS_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
REPORTS_CHANNEL_ID=-1003060449819
REPORT_INTERVAL_HOURS=3.0
REPORTS_TIMEZONE=Europe/Moscow
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç

```bash
python main.py
```

–û—Ç—á–µ—Ç—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞! ‚úÖ

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç—á–µ—Ç–æ–≤

```bash
# –ö–∞–∂–¥—ã–µ 3 —á–∞—Å–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)
REPORT_INTERVAL_HOURS=3.0

# –ö–∞–∂–¥—ã–π —á–∞—Å
REPORT_INTERVAL_HOURS=1.0

# –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
REPORT_INTERVAL_HOURS=0.5

# –ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
REPORT_INTERVAL_HOURS=0.17
```

### –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å

```bash
# –ú–æ—Å–∫–≤–∞
REPORTS_TIMEZONE=Europe/Moscow

# UTC
REPORTS_TIMEZONE=UTC

# –ù—å—é-–ô–æ—Ä–∫
REPORTS_TIMEZONE=America/New_York
```

## üìã –§–æ—Ä–º–∞—Ç –æ—Ç—á–µ—Ç–∞

–û—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```
üìà –û–¢–ß–ï–¢ SendMessageBot üü¢

‚è∞ –í—Ä–µ–º—è: 04.11.2025 00:48
üìä –°—Ç–∞—Ç—É—Å: –û—Ç–ª–∏—á–Ω–æ

üì§ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥:
   ‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 42
   ‚Ä¢ –û—à–∏–±–æ–∫: 3
   ‚Ä¢ FloodWait: 1
   ‚Ä¢ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 93.3%
   ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 0.52—Å

üîÑ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
   ‚Ä¢ –¶–∏–∫–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: 5
   ‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö broadcaster'–æ–≤: 2
   ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 15 –º–∏–Ω –Ω–∞–∑–∞–¥

üö® –¢–æ–ø –æ—à–∏–±–æ–∫:
   ‚Ä¢ FloodWaitError: 1
   ‚Ä¢ ChatWriteForbidden: 2

üí° –°–ª–µ–¥—É—é—â–∏–π –æ—Ç—á–µ—Ç —á–µ—Ä–µ–∑ 3 —á–∞—Å–∞
```

## üéØ –°—Ç–∞—Ç—É—Å—ã –æ—Ç—á–µ—Ç–∞

- üü¢ **–û—Ç–ª–∏—á–Ω–æ** - —É—Å–ø–µ—à–Ω–æ—Å—Ç—å ‚â• 95%
- üü° **–•–æ—Ä–æ—à–æ** - —É—Å–ø–µ—à–Ω–æ—Å—Ç—å ‚â• 80%
- üî¥ **–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è** - —É—Å–ø–µ—à–Ω–æ—Å—Ç—å < 80%

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏

```bash
python test_reports.py
```

–û—Ç–ø—Ä–∞–≤–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç —Å –º–æ–∫-–¥–∞–Ω–Ω—ã–º–∏.

### –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```bash
python test_reports_immediate.py
```

–ó–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç –Ω–∞ 3 –º–∏–Ω—É—Ç—ã –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

### –í—Å–µ –æ—Ç—á–µ—Ç—ã

```bash
tail -f bot.log | grep telegram_reporter
```

### –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

```bash
tail -f bot.log | grep "–û—Ç—á–µ—Ç #"
```

### –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

```bash
tail -f bot.log | grep -E "(ERROR.*telegram_reporter|–û—à–∏–±–∫–∞.*–æ—Ç—á–µ—Ç)"
```

## ‚ùì –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—Ç—á–µ—Ç—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. **–í–∫–ª—é—á–µ–Ω—ã –ª–∏ –æ—Ç—á–µ—Ç—ã:**
   ```bash
   echo $ENABLE_REPORTS
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: true
   ```

2. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ —Ç–æ–∫–µ–Ω:**
   ```bash
   curl "https://api.telegram.org/bot$REPORTS_BOT_TOKEN/getMe"
   # –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
   ```

3. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ ID –∫–∞–Ω–∞–ª–∞:**
   ```bash
   curl "https://api.telegram.org/bot$REPORTS_BOT_TOKEN/sendMessage?chat_id=$REPORTS_CHANNEL_ID&text=test"
   # –î–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   ```

4. **–ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞:**
   - –û—Ç—á–µ—Ç—ã –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ broadcaster'–æ–≤
   - –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–≤–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### –û—à–∏–±–∫–∞ "Bot was blocked by the user"

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–∞–Ω–∞–ª –≤–º–µ—Å—Ç–æ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

### –û—à–∏–±–∫–∞ "Chat not found"

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ ID –∫–∞–Ω–∞–ª–∞/—á–∞—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–∞–Ω–∞–ª/—á–∞—Ç
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –±–æ—Ç–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### –û—à–∏–±–∫–∞ "can't subtract offset-naive and offset-aware datetimes"

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–∞ –æ—à–∏–±–∫–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞.

### –û—à–∏–±–∫–∞ "invalid literal for int() with base 10: '0.17'"

**–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–∞ –æ—à–∏–±–∫–∞ —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–º–º–∏—Ç–∞.

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã –æ—Ç—á–µ—Ç–æ–≤

–í –∫–æ–¥–µ:
```python
if app.telegram_reporter:
    status = app.telegram_reporter.get_status()
    print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç—á–µ—Ç–æ–≤: {status['reports_sent']}")
    print(f"–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç: {status['last_report_time']}")
    print(f"–°–ª–µ–¥—É—é—â–∏–π –æ—Ç—á–µ—Ç: {status['next_report_time']}")
```

### –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞

–í –∫–æ–¥–µ:
```python
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
await app.telegram_reporter.send_report(app.broadcasters)

# –ò–ª–∏ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ force_send_report()
app.telegram_reporter.force_send_report()
```

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç–æ–¥ `_format_report_message()` –≤ `monitoring/reports.py`:

```python
def _format_report_message(self, report_data: ReportData) -> str:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞"""
    # –í–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    message = f"""
ü§ñ –ú–æ–π –æ—Ç—á–µ—Ç
–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {report_data.total_sent}
–û—à–∏–±–æ–∫: {report_data.total_failed}
    """
    return message
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫

–†–∞—Å—à–∏—Ä—å—Ç–µ –∫–ª–∞—Å—Å `ReportData` –≤ `monitoring/reports.py`:

```python
@dataclass
class ReportData:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    custom_metric: int = 0  # –í–∞—à–∞ –º–µ—Ç—Ä–∏–∫–∞
```

## üì± –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ `TelegramReporter`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞

```python
from monitoring.reports import TelegramReporter

reporter = TelegramReporter(
    bot_token="–≤–∞—à_—Ç–æ–∫–µ–Ω",
    channel_id="–≤–∞—à_id"
)

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
await reporter._send_telegram_message(
    "üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
    parse_mode="HTML"
)
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram Bot API:** https://core.telegram.org/bots/api
- **HTML —Ä–∞–∑–º–µ—Ç–∫–∞ –≤ Telegram:** https://core.telegram.org/bots/api#html-style
- **–ü–æ–ª—É—á–µ–Ω–∏–µ ID —á–∞—Ç–∞:** https://t.me/userinfobot

---

**‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!**

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞: 2025-11-04*

