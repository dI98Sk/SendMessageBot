# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "database is locked" –∏ –∑–∞–≤–∏—Å–∞–Ω–∏–π

**–î–∞—Ç–∞:** 2025-12-10  
**–í–µ—Ä—Å–∏—è:** 2.0

---

## üìä –ü—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ "database is locked"

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- Broadcaster'—ã –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç –≤ —Ü–∏–∫–ª–∞—Ö retry
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í—Å–µ 6 broadcaster'–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- SQLite –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ
- –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ 2 —Å–µ–∫—É–Ω–¥—ã –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞

### 2. ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–∞—Ç—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- `Could not find the input entity` - —á–∞—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- `ALLOW_PAYMENT_REQUIRED_1` - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ß–∞—Ç—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3. üî¥ –ó–∞–≤–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- Broadcaster'—ã –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç –≤ –ø–æ–ø—ã—Ç–∫–∞—Ö –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –ª–æ–≥–∞—Ö

---

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –ó–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ —Å 2 –¥–æ 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ broadcaster'–æ–≤
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ, —Ç–∞–∫ –∏ –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏

**–§–∞–π–ª—ã:**
- `main.py` - —Å—Ç—Ä–æ–∫–∏ 675 –∏ 465

### 2. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_connection_lock` –≤ `BroadcasterCoordinator`
- –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω broadcaster –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–§–∞–π–ª—ã:**
- `core/coordinator.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `acquire_connection_lock()` –∏ `release_connection_lock()`
- `core/broadcaster.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ `_ensure_connection()`

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —á–∞—Ç–æ–≤

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- RPCError 403 —Å `ALLOW_PAYMENT_REQUIRED_1` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- –í—Å–µ RPCError 403 - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω)
- ValueError (Could not find entity) - —É–∂–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è, —É–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `core/broadcaster.py` - —É–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ RPCError 403

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ OperationalError –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- OperationalError "database is locked" –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è, —á–∞—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞)
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª—ã:**
- `core/broadcaster.py` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ OperationalError –≤ –æ–±—â–µ–º –±–ª–æ–∫–µ Exception

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –£–¥–∞–ª–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–∞—Ç—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ß–∞—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:**
- `-1002814695489` - "Could not find the input entity"
- `-1001673828053` - "ALLOW_PAYMENT_REQUIRED_1" (—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞)

**–î–µ–π—Å—Ç–≤–∏–µ:**
```python
# –í config/targets.py —É–¥–∞–ª–∏—Ç—å —ç—Ç–∏ —á–∞—Ç—ã –∏–∑ –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤:
# - TARGETS
# - TARGETS_PRICE
# - TARGETS_ADS
# - B2C_TARGET
# - B2C_TARGET_MIDSLOW
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤:
```bash
grep "–ß–∞—Ç.*–¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö" bot.log
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ broadcaster'—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ "database is locked"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–∞—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç

---

## üîç –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. ‚úÖ **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ "database is locked":**
   - –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–∞–µ—Ç –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

2. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —á–∞—Ç–æ–≤:**
   - –ß–∞—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ù–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

3. ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞:**
   - Broadcaster'—ã –Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—é—Ç –≤ —Ü–∏–∫–ª–∞—Ö –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üìù –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [LOG_ANALYSIS_STARTUP_ISSUES.md](LOG_ANALYSIS_STARTUP_ISSUES.md) - –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- [STARTUP_FIXES_SUMMARY.md](STARTUP_FIXES_SUMMARY.md) - —Å–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- [INVALID_CHAT_ID_FIX.md](INVALID_CHAT_ID_FIX.md) - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å chat_id

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-10  
**–í–µ—Ä—Å–∏—è:** 1.0

