# üîç –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –∑–∞–ø—É—Å–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-12-10  
**–í–µ—Ä—Å–∏—è:** 2.0

---

## üìä –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û—à–∏–±–∫–∞:**
```
2025-12-10 15:23:34 [ERROR] main: ‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: 'TelegramConfig' object has no attribute 'phone'
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í `main.py` —Å—Ç—Ä–æ–∫–∞ 139 –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `self.config.telegram.phone`, –Ω–æ –≤ –∫–ª–∞—Å—Å–µ `TelegramConfig` –Ω–µ—Ç –∞—Ç—Ä–∏–±—É—Ç–∞ `phone`.

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. Telethon –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é.

---

### 2. ‚ö†Ô∏è –û—à–∏–±–∫–∞ "database is locked"

**–û—à–∏–±–∫–∞:**
```
2025-12-10 15:24:02 [ERROR] broadcaster.AAA_ADS_Broadcaster: ‚ùå [AAA_ADS_Broadcaster] –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: database is locked
2025-12-10 15:24:08 [ERROR] broadcaster.GUS_PRICE_Broadcaster: ‚ùå [GUS_PRICE_Broadcaster] –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: database is locked
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í—Å–µ 6 broadcaster'–æ–≤ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Telegram –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. SQLite (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telethon –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π) –±–ª–æ–∫–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ. –î–∞–∂–µ –µ—Å–ª–∏ —É –∫–∞–∂–¥–æ–≥–æ broadcaster'–∞ —Å–≤–æ–π —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏, –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–Ω–∏ –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å.

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É broadcaster'–∞–º–∏
2. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ "database is locked" —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º retry
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

### 3. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ –¥–ª—è GUS_B2C_MIDSLOW

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:**
```
2025-12-10 15:23:43 [WARNING] broadcaster.GUS_B2C_MIDSLOW_Broadcaster: ‚ö†Ô∏è  –§–∞–π–ª —Å–µ—Å—Å–∏–∏ sessions\acc1_b2c_midslow.session –Ω–µ –Ω–∞–π–¥–µ–Ω
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–æ—Ä–º–∞–ª—å–Ω–æ** - —Ñ–∞–π–ª —Å–æ–∑–¥–∞—Å—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–î–µ–π—Å—Ç–≤–∏–µ:** –ù—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `python scripts/setup_accounts.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π.

---

### 4. ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:**
```
2025-12-10 15:23:55 [WARNING] main: ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞!
```

**–ü—Ä–∏—á–∏–Ω–∞:** –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ broadcaster'—ã –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç—É (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞).

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–æ—Ä–º–∞–ª—å–Ω–æ** - —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –æ—Ç—á–µ—Ç—ã –Ω–∞—á–Ω—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ü–∏–∫–ª–∞.

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –£–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `phone` –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

**–§–∞–π–ª:** `main.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
```python
# –ë–´–õ–û:
await notification_client.start(phone=self.config.telegram.phone)

# –°–¢–ê–õ–û:
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –±–µ–∑ phone - Telethon –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é
await notification_client.start()
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ broadcaster'–æ–≤

**–§–∞–π–ª:** `main.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ broadcaster'–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö.

```python
async def _start_broadcasters(self):
    """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö broadcaster'–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏"""
    for i, broadcaster in enumerate(self.broadcasters):
        self.logger.info(f"–ó–∞–ø—É—Å–∫ broadcaster {i+1}/{len(self.broadcasters)}: {broadcaster.name}")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–≥–æ)
        if i > 0:
            await asyncio.sleep(2)  # 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏
        
        await broadcaster.start()
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É "database is locked"

**–§–∞–π–ª:** `core/broadcaster.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è –æ—à–∏–±–∫–∏ "database is locked" –≤ –º–µ—Ç–æ–¥–µ `_ensure_connection`.

```python
@retry_with_backoff(max_retries=5, base_delay=2, max_delay=10)
async def _ensure_connection(self):
    """–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram —Å retry –¥–ª—è database is locked"""
    try:
        if self._client and self._client.is_connected():
            return
        
        # –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π database is locked
        if not self._client:
            self._init_client()
        
        await self._client.connect()
        
        if not await self._client.is_user_authorized():
            raise BroadcastingError("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
            
    except Exception as e:
        error_msg = str(e).lower()
        if "database is locked" in error_msg or "locked" in error_msg:
            # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è database is locked
            self.logger.warning(f"‚ö†Ô∏è [{self.name}] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...")
            await asyncio.sleep(2)
            raise  # –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ retry
        else:
            raise
```

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã —Å–µ—Å—Å–∏–π –∑–∞—Ä–∞–Ω–µ–µ

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```cmd
python scripts/setup_accounts.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã —Å–µ—Å—Å–∏–π:
- `sessions/acc1_price.session`
- `sessions/acc2_price.session`
- `sessions/acc1_ads.session`
- `sessions/acc2_ads.session`
- `sessions/acc1_b2c.session`
- `sessions/acc1_b2c_midslow.session` ‚≠ê

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º —Å–µ—Å—Å–∏–π

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `sessions/`.

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í—Å–µ broadcaster'—ã –¥–æ–ª–∂–Ω—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥.

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (–∏–ª–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã)
2. ‚úÖ –í—Å–µ broadcaster'—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ "database is locked"
3. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç—á–µ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ü–∏–∫–ª–∞
4. ‚úÖ –í—Å–µ 6 broadcaster'–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [INVALID_CHAT_ID_FIX.md](INVALID_CHAT_ID_FIX.md) - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å chat_id
- [WINDOWS_LOG_ROTATION_FIX.md](WINDOWS_LOG_ROTATION_FIX.md) - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ª–æ–≥–∞–º–∏
- [LOG_ANALYSIS_AND_FIXES.md](LOG_ANALYSIS_AND_FIXES.md) - –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - –æ–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ—à–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-10  
**–í–µ—Ä—Å–∏—è:** 1.0

