# üìö API –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ SendMessageBot

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–ª–∞—Å—Å—ã)
- [üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [üöÄ –ë—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä—ã](#-–±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä—ã)
- [üìù –°–æ–æ–±—â–µ–Ω–∏—è](#-—Å–æ–æ–±—â–µ–Ω–∏—è)
- [üéØ –¶–µ–ª–∏](#-—Ü–µ–ª–∏)
- [üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã](#Ô∏è-—É—Ç–∏–ª–∏—Ç—ã)
- [üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#-–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Main App      ‚îÇ    ‚îÇ  Config Manager ‚îÇ    ‚îÇ  Logger         ‚îÇ
‚îÇ   (main.py)     ‚îÇ    ‚îÇ  (settings.py)  ‚îÇ    ‚îÇ  (logger.py)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Broadcasters   ‚îÇ    ‚îÇ  Google Sheets  ‚îÇ    ‚îÇ  Monitoring     ‚îÇ
‚îÇ  (broadcaster.py)‚îÇ    ‚îÇ  (google_sheets.py)‚îÇ    ‚îÇ  (monitoring/) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram API   ‚îÇ    ‚îÇ  Google API     ‚îÇ    ‚îÇ  Reports        ‚îÇ
‚îÇ  (Telethon)     ‚îÇ    ‚îÇ  (gspread)      ‚îÇ    ‚îÇ  (reports.py)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

### `EnhancedBroadcaster`

–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram.

```python
class EnhancedBroadcaster:
    def __init__(self, config: AppConfig, name: str, targets: List[int], 
                 messages: List[str], session_name: str):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞
        
        Args:
            config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            name: –ò–º—è –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞
            targets: –°–ø–∏—Å–æ–∫ ID —Ü–µ–ª–µ–≤—ã—Ö —á–∞—Ç–æ–≤
            messages: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            session_name: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–µ—Å—Å–∏–∏
        """
    
    async def start(self) -> None:
        """–ó–∞–ø—É—Å–∫ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞"""
    
    async def stop(self) -> None:
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞"""
    
    async def send_messages(self) -> None:
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ü–µ–ª–µ–≤—ã–µ —á–∞—Ç—ã"""
    
    async def _ensure_connection(self) -> None:
        """–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram"""
    
    async def _send_single_message(self, chat_id: int, message: str) -> bool:
        """–û—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç"""
```

### `ConfigManager`

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```python
class ConfigManager:
    def load_config(self) -> AppConfig:
        """
        –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env —Ñ–∞–π–ª–∞
        
        Returns:
            AppConfig: –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        """
    
    def save_config(self, config: AppConfig) -> None:
        """
        –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        
        Args:
            config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        """
    
    def validate_config(self, config: AppConfig) -> bool:
        """
        –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        
        Args:
            config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            
        Returns:
            bool: True –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞
        """
```

### `GoogleSheetsFetcher`

–†–∞–±–æ—Ç–∞ —Å Google Sheets.

```python
class GoogleSheetsFetcher:
    def __init__(self, credentials_path: str = "credentials.json"):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ Google Sheets
        
        Args:
            credentials_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        """
    
    def fetch_messages(self, sheet_url: str) -> List[str]:
        """
        –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Google Sheets
        
        Args:
            sheet_url: URL —Ç–∞–±–ª–∏—Ü—ã
            
        Returns:
            List[str]: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
        """
    
    def test_connection(self, sheet_url: str) -> bool:
        """
        –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–∞–±–ª–∏—Ü–µ
        
        Args:
            sheet_url: URL —Ç–∞–±–ª–∏—Ü—ã
            
        Returns:
            bool: True –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
        """
```

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### `AppConfig`

–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

```python
@dataclass
class AppConfig:
    # Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    api_id: int
    api_hash: str
    phone: str
    
    # –¶–µ–ª–∏
    targets: List[int]
    
    # –°–æ–æ–±—â–µ–Ω–∏—è
    b2b_messages: List[str]
    b2c_messages: List[str]
    aaa_messages: List[str]
    gus_messages: List[str]
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏
    message_delay: int = 1
    max_retries: int = 3
    flood_wait_delay: int = 60
    
    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    log_level: str = "INFO"
    log_file: str = "logs/bot.log"
```

### `GoogleSheetsConfig`

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Google Sheets.

```python
@dataclass
class GoogleSheetsConfig:
    b2b_sheet_url: Optional[str] = None
    b2c_sheet_url: Optional[str] = None
    aaa_sheet_url: Optional[str] = None
    gus_sheet_url: Optional[str] = None
```

### `LoggingConfig`

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

```python
@dataclass
class LoggingConfig:
    level: str = "INFO"
    file: str = "logs/bot.log"
    max_size: int = 10485760  # 10MB
    backup_count: int = 5
    format: str = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
```

## üöÄ –ë—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞

```python
from core.broadcaster import EnhancedBroadcaster
from config.settings import config_manager

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = config_manager.load_config()

# –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞
broadcaster = EnhancedBroadcaster(
    config=config,
    name="B2B_Broadcaster",
    targets=config.targets,
    messages=config.b2b_messages,
    session_name="sessions/acc1"
)

# –ó–∞–ø—É—Å–∫
await broadcaster.start()
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞–º–∏

```python
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
broadcasters = [
    EnhancedBroadcaster(config, "B2B", targets, b2b_messages, "sessions/acc1"),
    EnhancedBroadcaster(config, "B2C", targets, b2c_messages, "sessions/acc2"),
    EnhancedBroadcaster(config, "AAA", targets, aaa_messages, "sessions/acc1"),
    EnhancedBroadcaster(config, "GUS", targets, gus_messages, "sessions/acc2"),
]

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
for broadcaster in broadcasters:
    await broadcaster.start()

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
for broadcaster in broadcasters:
    await broadcaster.stop()
```

## üìù –°–æ–æ–±—â–µ–Ω–∏—è

### –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

```python
from config.messages import MESSAGESB2B, MESSAGESB2C
from config.messages_aaa import MESSAGESAAA
from config.messages_gus import MESSAGESGUS

# –õ–æ–∫–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
b2b_messages = MESSAGESB2B
b2c_messages = MESSAGESB2C
aaa_messages = MESSAGESAAA
gus_messages = MESSAGESGUS
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Google Sheets

```python
from utils.google_sheets import GoogleSheetsFetcher

fetcher = GoogleSheetsFetcher()

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ B2B —Å–æ–æ–±—â–µ–Ω–∏–π
b2b_messages = fetcher.fetch_messages(config.b2b_sheet_url)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ B2C —Å–æ–æ–±—â–µ–Ω–∏–π
b2c_messages = fetcher.fetch_messages(config.b2c_sheet_url)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ AAA —Å–æ–æ–±—â–µ–Ω–∏–π
aaa_messages = fetcher.fetch_messages(config.aaa_sheet_url)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ GUS —Å–æ–æ–±—â–µ–Ω–∏–π
gus_messages = fetcher.fetch_messages(config.gus_sheet_url)
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

```python
def format_message(message: str, variables: dict = None) -> str:
    """
    –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
    
    Args:
        message: –ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        variables: –°–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    """
    if variables:
        return message.format(**variables)
    return message

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
message = "–ü—Ä–∏–≤–µ—Ç, {name}! –¶–µ–Ω–∞: {price} —Ä—É–±."
formatted = format_message(message, {"name": "–ò–≤–∞–Ω", "price": "1000"})
```

## üéØ –¶–µ–ª–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤—ã–º–∏ —á–∞—Ç–∞–º–∏

```python
from config.targets import TEST_TARGETS, PRODUCTION_TARGETS

# –¢–µ—Å—Ç–æ–≤—ã–µ —á–∞—Ç—ã
test_chats = TEST_TARGETS

# –û—Å–Ω–æ–≤–Ω—ã–µ —á–∞—Ç—ã
production_chats = PRODUCTION_TARGETS

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∏ –æ—Å–Ω–æ–≤–Ω—ã–º–∏
use_test_chats = True
targets = TEST_TARGETS if use_test_chats else PRODUCTION_TARGETS
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ü–µ–ª–µ–π

```python
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞
new_chat_id = -1001234567890
TEST_TARGETS.append(new_chat_id)

# –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
TEST_TARGETS.remove(-1001234567890)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞
if chat_id in TEST_TARGETS:
    print("–ß–∞—Ç –Ω–∞–π–¥–µ–Ω")
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫

```python
from monitoring.metrics import MetricsCollector

collector = MetricsCollector()

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
collector.increment_sent_messages()

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –æ—à–∏–±–æ–∫
collector.increment_errors()

# –ó–∞–ø–∏—Å—å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
collector.record_execution_time("send_message", 1.5)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
stats = collector.get_stats()
print(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {stats['sent_messages']}")
print(f"–û—à–∏–±–æ–∫: {stats['errors']}")
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
from utils.logger import get_logger

# –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞
logger = get_logger("broadcaster", config.logging)

# –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger.debug("–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
logger.info("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
logger.warning("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ")
logger.error("–û—à–∏–±–∫–∞")
logger.critical("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞")

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
logger.info("–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è", extra={
    "chat_id": chat_id,
    "message_length": len(message)
})
```

### –û—Ç—á–µ—Ç—ã

```python
from monitoring.reports import ReportGenerator

generator = ReportGenerator()

# –°–æ–∑–¥–∞–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
daily_report = generator.generate_daily_report()

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –ø–æ –æ—à–∏–±–∫–∞–º
error_report = generator.generate_error_report()

# –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞
generator.send_report(daily_report, "admin@example.com")
```

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
from core.retry import retry_with_backoff
from core.exceptions import FloodWaitError

@retry_with_backoff(max_retries=3, base_delay=5)
async def send_message_with_retry(chat_id: int, message: str):
    """
    –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
    
    Args:
        chat_id: ID —á–∞—Ç–∞
        message: –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    """
    try:
        await client.send_message(chat_id, message)
    except FloodWaitError as e:
        logger.warning(f"FloodWait: {e.seconds} —Å–µ–∫—É–Ω–¥")
        raise
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {e}")
        raise
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
from utils.helpers import validate_chat_id, validate_message

def validate_broadcaster_data(targets: List[int], messages: List[str]) -> bool:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–∞
    
    Args:
        targets: –°–ø–∏—Å–æ–∫ ID —á–∞—Ç–æ–≤
        messages: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
        
    Returns:
        bool: True –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–µ–π
    for chat_id in targets:
        if not validate_chat_id(chat_id):
            return False
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    for message in messages:
        if not validate_message(message):
            return False
    
    return True
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```python
from utils.security import SecurityManager

security = SecurityManager()

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
encrypted_data = security.encrypt("sensitive_data")

# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
decrypted_data = security.decrypt(encrypted_data)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤
is_valid = security.verify_file_integrity("sessions/acc1.session")
```

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞

```python
import asyncio
from config.settings import config_manager
from core.broadcaster import EnhancedBroadcaster

async def main():
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    config = config_manager.load_config()
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
    broadcasters = [
        EnhancedBroadcaster(config, "B2B", config.targets, config.b2b_messages, "sessions/acc1"),
        EnhancedBroadcaster(config, "B2C", config.targets, config.b2c_messages, "sessions/acc2"),
        EnhancedBroadcaster(config, "AAA", config.targets, config.aaa_messages, "sessions/acc1"),
        EnhancedBroadcaster(config, "GUS", config.targets, config.gus_messages, "sessions/acc2"),
    ]
    
    try:
        # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
        for broadcaster in broadcasters:
            await broadcaster.start()
        
        # –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        await asyncio.gather(*[b.send_messages() for b in broadcasters])
        
    finally:
        # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –±—Ä–æ—É–¥–∫–∞—Å—Ç–µ—Ä–æ–≤
        for broadcaster in broadcasters:
            await broadcaster.stop()

if __name__ == "__main__":
    asyncio.run(main())
```

### –ü—Ä–∏–º–µ—Ä —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

```python
import asyncio
from core.exceptions import FloodWaitError, RetryError

async def robust_broadcasting():
    try:
        await broadcaster.start()
        await broadcaster.send_messages()
    except FloodWaitError as e:
        logger.warning(f"FloodWait: {e.seconds} —Å–µ–∫—É–Ω–¥")
        await asyncio.sleep(e.seconds)
        await robust_broadcasting()
    except RetryError as e:
        logger.error(f"–ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: {e}")
    except Exception as e:
        logger.critical(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        raise
```

### –ü—Ä–∏–º–µ—Ä —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º

```python
import asyncio
from monitoring.metrics import MetricsCollector
from monitoring.reports import ReportGenerator

async def monitored_broadcasting():
    metrics = MetricsCollector()
    reporter = ReportGenerator()
    
    try:
        start_time = time.time()
        
        await broadcaster.start()
        await broadcaster.send_messages()
        
        execution_time = time.time() - start_time
        metrics.record_execution_time("broadcasting", execution_time)
        
    except Exception as e:
        metrics.increment_errors()
        logger.error(f"–û—à–∏–±–∫–∞: {e}")
        
    finally:
        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
        report = reporter.generate_daily_report()
        reporter.send_report(report)
```

---

**–£–¥–∞—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API! üöÄ**

