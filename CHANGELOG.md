# üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (Changelog)

## [–í–µ—Ä—Å–∏—è 2024-10-17] - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è broadcaster'–æ–≤

### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

#### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ broadcaster'–æ–≤ (4 –≤–º–µ—Å—Ç–æ 2)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ—Å—å 4 broadcaster'–∞ –≤–º–µ—Å—Ç–æ 2
- B2B –∏ B2C broadcaster'—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å

**–ü—Ä–∏—á–∏–Ω–∞:**
–í –º–µ—Ç–æ–¥–µ `initialize()` broadcaster'—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –¥–≤–∞–∂–¥—ã:
1. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ Google Sheets: `_setup_google_sheets()` ‚Üí `_initial_message_update()` ‚Üí `_recreate_broadcasters()` (—Å–æ–∑–¥–∞–µ—Ç 2)
2. –ü—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: `_create_broadcasters()` (—Å–æ–∑–¥–∞–µ—Ç –µ—â–µ 2)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
if not self.broadcasters:
    await self._create_broadcasters()
else:
    self.logger.info(f"Broadcaster'—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã: {len(self.broadcasters)} —à—Ç.")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ 2 broadcaster'–∞ (B2B –∏ B2C)

---

#### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û–±–∞ broadcaster'–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç (ID: 8108419249)
- –í—Ç–æ—Ä–æ–π –∞–∫–∫–∞—É–Ω—Ç (ID: 8497033180) –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- B2B broadcaster —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sessions/acc1` (ID: 8108419249)
- B2C broadcaster —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `sessions/acc2` (ID: 8497033180)
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `session_name` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä `EnhancedBroadcaster`

**–ö–æ–¥:**

```python
# B2B Broadcaster
b2b_broadcaster = EnhancedBroadcaster(
    config=self.config,
    name="B2B_Broadcaster",
    targets=self.config.targets,
    messages=self.config.b2b_messages,
    session_name="sessions/acc1"  # ID: 8108419249
)

# B2C Broadcaster
b2c_broadcaster = EnhancedBroadcaster(
    config=self.config,
    name="B2C_Broadcaster",
    targets=self.config.targets,
    messages=self.config.b2c_messages,
    session_name="sessions/acc2"  # ID: 8497033180
)
```

---

#### 3. –û—à–∏–±–∫–∞ "unable to open database file" –Ω–∞ Windows

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ –º–æ–≥–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Ñ–∞–π–ª—ã —Å–µ—Å—Å–∏–π –Ω–∞ Windows Server
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `sessions/` –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `sessions/`
- –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏

**–ö–æ–¥:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–µ—Å—Å–∏–π
from pathlib import Path
session_path = Path(self.session_name)
session_dir = session_path.parent

if session_dir and str(session_dir) != '.':
    session_dir.mkdir(parents=True, exist_ok=True)
```

---

#### 4. –û—à–∏–±–∫–∞ "Invalid JWT Signature" Google Sheets

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Google Sheets –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ù–µ–ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å `credentials.json`
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è JWT –æ—à–∏–±–æ–∫:
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é credentials.json
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ Service Account

---

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### 1. –°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `check_environment.py`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –í–µ—Ä—Å–∏—é Python
- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ñ–∞–π–ª—ã —Å–µ—Å—Å–∏–π
- ‚úÖ –§–∞–π–ª credentials.json
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
python check_environment.py
```

---

#### 2. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ broadcaster'–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- ID –∞–∫–∫–∞—É–Ω—Ç–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ broadcaster'–æ–≤ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ó–∞–ø—É—Å–∫ –∫–∞–∂–¥–æ–≥–æ broadcaster'–∞

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:**
```
2024-10-17 12:00:00 [INFO] –°–æ–∑–¥–∞–Ω–∏–µ broadcaster'–æ–≤... (—Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 0)
2024-10-17 12:00:01 [INFO] –í—Å–µ–≥–æ broadcaster'–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è: 2
2024-10-17 12:00:02 [INFO] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ broadcaster'–æ–≤ –¥–ª—è –∑–∞–ø—É—Å–∫–∞: 2
2024-10-17 12:00:03 [INFO] –ó–∞–ø—É—Å–∫ broadcaster 1/2: B2B_Broadcaster
2024-10-17 12:00:04 [INFO] ‚úÖ B2B_Broadcaster –ø–æ–¥–∫–ª—é—á–µ–Ω: ID=8108419249, Name=–í–ª–∞–¥–∏–º–∏—Ä
2024-10-17 12:00:05 [INFO] –ó–∞–ø—É—Å–∫ broadcaster 2/2: B2C_Broadcaster
2024-10-17 12:00:06 [INFO] ‚úÖ B2C_Broadcaster –ø–æ–¥–∫–ª—é—á–µ–Ω: ID=8497033180, Name=–Ø–±–ª–æ—á–Ω—ã–π –ì—É—Å—å
```

---

### üìö –ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### 1. TROUBLESHOOTING.md
–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º:
- –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

#### 2. WINDOWS_SETUP.md
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –Ω–∞ Windows Server:
- –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
- –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PowerShell

#### 3. CHANGELOG.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
–ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ–µ–∫—Ç–µ

---

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è broadcaster'–æ–≤**
   ```python
   if not self.broadcasters:
       await self._create_broadcasters()
   ```

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π**
   ```python
   session_dir.mkdir(parents=True, exist_ok=True)
   ```

3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Google Sheets**
   - –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Google Sheets
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ `config/messages.py` –∫–∞–∫ fallback

4. **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ credentials.json**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

---

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π

### –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏:

1. **–ü–æ–¥—Ç—è–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git pull
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é sessions:**
   ```bash
   mkdir sessions
   cp acc1.session sessions/
   cp acc2.session sessions/
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:**
   ```bash
   python check_environment.py
   ```

4. **–ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã** (–µ—Å–ª–∏ –µ—Å—Ç—å)

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   python main_improved.py
   ```

---

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

–ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º.

---

## –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- [ ] Dashboard —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus/Grafana
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Telegram –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–ï—Å–ª–∏ –≤—ã –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
1. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ GitHub
2. –ò–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

**–í–ê–ñ–ù–û:** –ù–µ –ø—É–±–ª–∏–∫—É–π—Ç–µ –≤ issues —Ñ–∞–π–ª—ã `.env`, `credentials.json` –∏–ª–∏ `.session`!

